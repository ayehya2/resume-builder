<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Builder ‚Äì Integration Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            color: #333;
            padding: 30px;
        }

        .wrapper {
            max-width: 960px;
            margin: 0 auto;
        }

        h1 {
            font-size: 26px;
            margin-bottom: 4px;
        }

        .sub {
            color: #666;
            font-size: 14px;
            margin-bottom: 24px;
        }

        .card {
            background: #fff;
            border-radius: 10px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, .08);
            margin-bottom: 18px;
        }

        .card h2 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #444;
        }

        .row {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .row>* {
            flex: 1;
            min-width: 140px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 3px;
            color: #555;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            background: #fff;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #5b7fe9;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .entry {
            background: #f9f9fb;
            border: 1px solid #e8e8ec;
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 10px;
            position: relative;
        }

        .entry .remove {
            position: absolute;
            top: 8px;
            right: 10px;
            background: none;
            border: none;
            color: #c44;
            cursor: pointer;
            font-size: 18px;
        }

        .add-btn {
            background: none;
            border: 1px dashed #aaa;
            border-radius: 6px;
            padding: 8px;
            width: 100%;
            color: #666;
            cursor: pointer;
            font-size: 13px;
            margin-bottom: 6px;
        }

        .add-btn:hover {
            border-color: #5b7fe9;
            color: #5b7fe9;
        }

        .actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: .2s;
        }

        .btn-primary {
            background: #5b7fe9;
            color: #fff;
        }

        .btn-primary:hover {
            background: #4a6cd8;
        }

        .btn-secondary {
            background: #eee;
            color: #333;
        }

        .btn-secondary:hover {
            background: #ddd;
        }

        .btn-success {
            background: #2ea043;
            color: #fff;
        }

        .btn-success:hover {
            background: #238636;
        }

        .btn-danger {
            background: #c44;
            color: #fff;
        }

        .btn-danger:hover {
            background: #a33;
        }

        .json-area {
            width: 100%;
            min-height: 200px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 14px;
            resize: vertical;
            background: #1e1e2e;
            color: #a6e3a1;
            tab-size: 2;
        }

        .json-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .json-actions .btn {
            padding: 8px 16px;
            font-size: 13px;
        }

        .status {
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 13px;
            margin-top: 10px;
            display: none;
        }

        .status.success {
            display: block;
            background: #d1f7c4;
            color: #1a7f37;
        }

        .status.error {
            display: block;
            background: #fdd;
            color: #a33;
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .checkbox-row input[type="checkbox"] {
            width: auto;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <h1>üß™ Resume Builder ‚Äì Integration Tester</h1>
        <p class="sub">Fill in the data below, then click <strong>"Open Resume Builder"</strong>. It will open in a new
            tab with everything pre-filled. You can also save/load the exact JSON for database storage.</p>

        <!-- ‚îÄ‚îÄ BASICS ‚îÄ‚îÄ -->
        <div class="card">
            <h2>üë§ Basics / Profile</h2>
            <div class="row">
                <div><label>Full Name</label><input id="name" placeholder="John Doe"></div>
                <div><label>Email</label><input id="email" placeholder="john@example.com"></div>
            </div>
            <div class="row">
                <div><label>Phone</label><input id="phone" placeholder="(555) 123-4567"></div>
                <div><label>Address</label><input id="address" placeholder="New York, NY"></div>
            </div>
            <div class="row">
                <div><label>LinkedIn URL</label><input id="linkedin" placeholder="https://linkedin.com/in/..."></div>
                <div><label>GitHub URL</label><input id="github" placeholder="https://github.com/..."></div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ WORK EXPERIENCE ‚îÄ‚îÄ -->
        <div class="card">
            <h2>üíº Work Experience</h2>
            <div id="workEntries"></div>
            <button class="add-btn" onclick="addWork()">+ Add Work Experience</button>
        </div>

        <!-- ‚îÄ‚îÄ EDUCATION ‚îÄ‚îÄ -->
        <div class="card">
            <h2>üéì Education</h2>
            <div id="eduEntries"></div>
            <button class="add-btn" onclick="addEdu()">+ Add Education</button>
        </div>

        <!-- ‚îÄ‚îÄ SKILLS ‚îÄ‚îÄ -->
        <div class="card">
            <h2>üõ†Ô∏è Skills</h2>
            <div id="skillEntries"></div>
            <button class="add-btn" onclick="addSkill()">+ Add Skill Category</button>
        </div>

        <!-- ‚îÄ‚îÄ PROJECTS ‚îÄ‚îÄ -->
        <div class="card">
            <h2>üìÅ Projects</h2>
            <div id="projectEntries"></div>
            <button class="add-btn" onclick="addProject()">+ Add Project</button>
        </div>

        <!-- ‚îÄ‚îÄ AWARDS ‚îÄ‚îÄ -->
        <div class="card">
            <h2>üèÜ Awards</h2>
            <div id="awardEntries"></div>
            <button class="add-btn" onclick="addAward()">+ Add Award</button>
        </div>

        <!-- ‚îÄ‚îÄ CUSTOM SECTIONS ‚îÄ‚îÄ -->
        <div class="card">
            <h2>‚öôÔ∏è Custom Sections</h2>
            <p style="font-size:13px;color:#888;margin-bottom:12px;">Each custom section gets its own tab in the resume
                builder with its own set of entries.</p>
            <div id="customSectionEntries"></div>
            <button class="add-btn" onclick="addCustomSection()">+ Add Custom Section</button>
        </div>

        <!-- ‚îÄ‚îÄ JOB POSTING (auto cover letter) ‚îÄ‚îÄ -->
        <div class="card">
            <h2>üìù Job Posting (auto-generates cover letter)</h2>
            <div class="row">
                <div><label>Job Title</label><input id="jobTitle" placeholder="Senior Software Engineer"></div>
                <div><label>Company Name</label><input id="jobCompany" placeholder="TechCorp"></div>
            </div>
            <div class="row">
                <div><label>Company Address</label><input id="jobAddress" placeholder="123 Tech St, SF, CA"></div>
                <div><label>Required Skills (comma-separated)</label><input id="jobSkills"
                        placeholder="React, TypeScript, Node.js"></div>
            </div>
            <div><label>Job Description</label><textarea id="jobDesc"
                    placeholder="Brief description of the role..."></textarea></div>
        </div>

        <!-- ‚îÄ‚îÄ TEMPLATE & FORMATTING ‚îÄ‚îÄ -->
        <div class="card">
            <h2>üé® Template & Formatting</h2>

            <!-- Row 1: Template, Font, Font Size -->
            <div class="row">
                <div>
                    <label>Template</label>
                    <select id="fmtTemplate">
                        <option value="">(default)</option>
                        <option value="1">1 ‚Äì Classic</option>
                        <option value="2">2 ‚Äì Modern</option>
                        <option value="3">3 ‚Äì Minimal</option>
                        <option value="4">4 ‚Äì Professional</option>
                    </select>
                </div>
                <div>
                    <label>Font Family</label>
                    <select id="fmtFontFamily">
                        <option value="">(default)</option>
                        <option value="times">Times New Roman</option>
                        <option value="arial">Arial</option>
                        <option value="calibri">Calibri</option>
                        <option value="georgia">Georgia</option>
                        <option value="helvetica">Helvetica</option>
                        <option value="palatino">Palatino</option>
                        <option value="garamond">Garamond</option>
                    </select>
                </div>
                <div>
                    <label>Base Font Size</label>
                    <select id="fmtBaseFontSize">
                        <option value="">(default)</option>
                        <option value="9pt">9pt</option>
                        <option value="10pt">10pt</option>
                        <option value="11pt">11pt</option>
                        <option value="12pt">12pt</option>
                    </select>
                </div>
            </div>

            <!-- Row 2: Name Size, Section Title Size, Section Header Style -->
            <div class="row">
                <div>
                    <label>Name Size</label>
                    <select id="fmtNameSize">
                        <option value="">(default)</option>
                        <option value="huge">Huge</option>
                        <option value="large">Large</option>
                        <option value="large2">Large 2</option>
                        <option value="normal">Normal</option>
                    </select>
                </div>
                <div>
                    <label>Section Title Size</label>
                    <select id="fmtSectionTitleSize">
                        <option value="">(default)</option>
                        <option value="large">Large</option>
                        <option value="normal">Normal</option>
                        <option value="small">Small</option>
                    </select>
                </div>
                <div>
                    <label>Section Header Style</label>
                    <select id="fmtSectionHeaderStyle">
                        <option value="">(default)</option>
                        <option value="uppercase">UPPERCASE</option>
                        <option value="capitalize">Capitalize</option>
                        <option value="normal">Normal</option>
                    </select>
                </div>
            </div>

            <!-- Row 3: Bold/Underline toggles, Header Alignment -->
            <div class="row">
                <div>
                    <label>&nbsp;</label>
                    <div class="checkbox-row">
                        <input type="checkbox" id="fmtSectionTitleBold">
                        <label for="fmtSectionTitleBold" style="margin:0">Section Title Bold</label>
                    </div>
                    <div class="checkbox-row">
                        <input type="checkbox" id="fmtSectionTitleUnderline">
                        <label for="fmtSectionTitleUnderline" style="margin:0">Section Title Underline</label>
                    </div>
                    <div class="checkbox-row">
                        <input type="checkbox" id="fmtShowIcons">
                        <label for="fmtShowIcons" style="margin:0">Show Icons</label>
                    </div>
                </div>
                <div>
                    <label>Header Alignment</label>
                    <select id="fmtHeaderAlignment">
                        <option value="">(default)</option>
                        <option value="left">Left</option>
                        <option value="center">Center</option>
                        <option value="right">Right</option>
                    </select>
                </div>
                <div>
                    <label>Social Icon Style</label>
                    <select id="fmtSocialIconStyle">
                        <option value="">(default)</option>
                        <option value="circle">Circle</option>
                        <option value="square">Square</option>
                        <option value="none">None</option>
                    </select>
                </div>
            </div>

            <!-- Row 4: Font Weights -->
            <div class="row">
                <div>
                    <label>Font Weight ‚Äì Name</label>
                    <select id="fmtFontWeightName">
                        <option value="">(default)</option>
                        <option value="400">Normal (400)</option>
                        <option value="500">Medium (500)</option>
                        <option value="600">Semi-Bold (600)</option>
                        <option value="700">Bold (700)</option>
                        <option value="800">Extra-Bold (800)</option>
                    </select>
                </div>
                <div>
                    <label>Font Weight ‚Äì Section Title</label>
                    <select id="fmtFontWeightSectionTitle">
                        <option value="">(default)</option>
                        <option value="400">Normal (400)</option>
                        <option value="500">Medium (500)</option>
                        <option value="600">Semi-Bold (600)</option>
                        <option value="700">Bold (700)</option>
                        <option value="800">Extra-Bold (800)</option>
                    </select>
                </div>
                <div>
                    <label>Font Weight ‚Äì Body</label>
                    <select id="fmtFontWeightBody">
                        <option value="">(default)</option>
                        <option value="300">Light (300)</option>
                        <option value="400">Normal (400)</option>
                        <option value="500">Medium (500)</option>
                    </select>
                </div>
            </div>

            <!-- Row 5: Spacing -->
            <div class="row">
                <div>
                    <label>Line Spacing</label>
                    <select id="fmtLineSpacing">
                        <option value="">(default)</option>
                        <option value="1.0">1.0</option>
                        <option value="1.15">1.15</option>
                        <option value="1.2">1.2</option>
                        <option value="1.5">1.5</option>
                    </select>
                </div>
                <div>
                    <label>Section Spacing</label>
                    <select id="fmtSectionSpacing">
                        <option value="">(default)</option>
                        <option value="tight">Tight</option>
                        <option value="normal">Normal</option>
                        <option value="relaxed">Relaxed</option>
                        <option value="spacious">Spacious</option>
                    </select>
                </div>
                <div>
                    <label>Paragraph Spacing</label>
                    <select id="fmtParagraphSpacing">
                        <option value="">(default)</option>
                        <option value="tight">Tight</option>
                        <option value="normal">Normal</option>
                        <option value="relaxed">Relaxed</option>
                        <option value="spacious">Spacious</option>
                    </select>
                </div>
            </div>

            <!-- Row 6: Granular Spacing -->
            <div class="row">
                <div>
                    <label>Entry Spacing</label>
                    <select id="fmtEntrySpacing">
                        <option value="">(default)</option>
                        <option value="tight">Tight</option>
                        <option value="normal">Normal</option>
                        <option value="relaxed">Relaxed</option>
                        <option value="spacious">Spacious</option>
                    </select>
                </div>
                <div>
                    <label>Bullet Spacing</label>
                    <select id="fmtBulletSpacing">
                        <option value="">(default)</option>
                        <option value="tight">Tight</option>
                        <option value="normal">Normal</option>
                        <option value="relaxed">Relaxed</option>
                        <option value="spacious">Spacious</option>
                    </select>
                </div>
                <div>
                    <label>Bullet Gap</label>
                    <input id="fmtBulletGap" placeholder="e.g. 4px, 6px">
                </div>
            </div>

            <!-- Row 7: Margins -->
            <div class="row">
                <div>
                    <label>Page Margins Preset</label>
                    <select id="fmtPageMargins">
                        <option value="">(default)</option>
                        <option value="narrow">Narrow</option>
                        <option value="normal">Normal</option>
                        <option value="wide">Wide</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div><label>Margin Top</label><input id="fmtMarginTop" placeholder="e.g. 0.5in"></div>
                <div><label>Margin Bottom</label><input id="fmtMarginBottom" placeholder="e.g. 0.5in"></div>
                <div><label>Margin Left</label><input id="fmtMarginLeft" placeholder="e.g. 0.5in"></div>
                <div><label>Margin Right</label><input id="fmtMarginRight" placeholder="e.g. 0.5in"></div>
            </div>

            <!-- Row 8: Decorative -->
            <div class="row">
                <div>
                    <label>Color Theme</label>
                    <select id="fmtColorTheme">
                        <option value="">(default)</option>
                        <option value="black">Black</option>
                        <option value="navy">Navy</option>
                        <option value="darkblue">Dark Blue</option>
                        <option value="darkgreen">Dark Green</option>
                        <option value="maroon">Maroon</option>
                        <option value="purple">Purple</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div><label>Custom Color (hex)</label><input id="fmtCustomColor" placeholder="#3b82f6"></div>
                <div>
                    <label>Bullet Style</label>
                    <select id="fmtBulletStyle">
                        <option value="">(default)</option>
                        <option value="bullet">‚Ä¢ Bullet</option>
                        <option value="dash">‚Äì Dash</option>
                        <option value="arrow">‚ñ∂ Arrow</option>
                        <option value="circle">‚óã Circle</option>
                        <option value="square">‚ñ† Square</option>
                        <option value="diamond">‚óÜ Diamond</option>
                        <option value="star">‚òÖ Star</option>
                        <option value="chevron">‚Ä∫ Chevron</option>
                    </select>
                </div>
                <div>
                    <label>Bullet Indent</label>
                    <select id="fmtBulletIndent">
                        <option value="">(default)</option>
                        <option value="none">None</option>
                        <option value="small">Small</option>
                        <option value="medium">Medium</option>
                        <option value="large">Large</option>
                    </select>
                </div>
            </div>

            <!-- Row 9: Dividers, Lines, Separator -->
            <div class="row">
                <div>
                    <label>Section Dividers</label>
                    <select id="fmtSectionDividers">
                        <option value="">(default)</option>
                        <option value="none">None</option>
                        <option value="line">Line</option>
                        <option value="double">Double</option>
                        <option value="thick">Thick</option>
                        <option value="dotted">Dotted</option>
                    </select>
                </div>
                <div>
                    <label>Header Line Style</label>
                    <select id="fmtHeaderLineStyle">
                        <option value="">(default)</option>
                        <option value="none">None</option>
                        <option value="thin">Thin</option>
                        <option value="medium">Medium</option>
                        <option value="thick">Thick</option>
                        <option value="double">Double</option>
                        <option value="dotted">Dotted</option>
                        <option value="dashed">Dashed</option>
                    </select>
                </div>
                <div>
                    <label>Separator</label>
                    <select id="fmtSeparator">
                        <option value="">(default)</option>
                        <option value="‚Ä¢">‚Ä¢ (bullet)</option>
                        <option value="|">| (pipe)</option>
                        <option value="¬∑">¬∑ (middle dot)</option>
                        <option value="‚Äî">‚Äî (em dash)</option>
                    </select>
                </div>
                <div>
                    <label>Page Format</label>
                    <select id="fmtPageFormat">
                        <option value="">(default)</option>
                        <option value="Letter">Letter</option>
                        <option value="A4">A4</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ ACTIONS ‚îÄ‚îÄ -->
        <div class="actions">
            <button class="btn btn-primary" onclick="openResumeBuilder()">üöÄ Open Resume Builder</button>
            <button class="btn btn-secondary" onclick="fillSampleData()">üìù Fill Sample Data</button>
        </div>

        <!-- ‚îÄ‚îÄ JSON SAVE / LOAD ‚îÄ‚îÄ -->
        <div class="card" style="margin-top: 24px;">
            <h2>üíæ JSON Save / Load</h2>
            <p style="font-size:13px;color:#888;margin-bottom:12px;">This is the exact JSON blob you can store in a
                database and load later to recreate the same resume.</p>
            <textarea id="jsonEditor" class="json-area"
                placeholder="Click 'Build JSON from form' or paste your saved JSON here..."></textarea>
            <div class="json-actions">
                <button class="btn btn-secondary" onclick="buildAndShowJson()">üìã Build JSON from Form</button>
                <button class="btn btn-secondary" onclick="copyJson()">üìÑ Copy to Clipboard</button>
                <button class="btn btn-success" onclick="saveJsonToFile()">üíæ Save to File</button>
                <button class="btn btn-secondary" onclick="loadJsonFromFile()">üìÇ Load from File</button>
                <button class="btn btn-primary" onclick="loadJsonIntoBuilder()">üöÄ Load JSON into Resume
                    Builder</button>
            </div>
            <input type="file" id="jsonFileInput" accept=".json" style="display:none" onchange="handleFileLoad(event)">
            <div id="jsonStatus" class="status"></div>
        </div>
    </div>

    <script>
        /* ‚îÄ‚îÄ Dynamic entry helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

        function addWork() {
            const div = document.getElementById('workEntries');
            const el = document.createElement('div');
            el.className = 'entry';
            el.innerHTML = `
      <button class="remove" onclick="this.parentElement.remove()">√ó</button>
      <div class="row">
        <div><label>Company</label><input class="w-company" placeholder="Acme Inc."></div>
        <div><label>Position</label><input class="w-position" placeholder="Software Engineer"></div>
      </div>
      <div class="row">
        <div><label>Location</label><input class="w-location" placeholder="San Francisco, CA"></div>
        <div><label>Start Date</label><input class="w-start" placeholder="Jan 2022"></div>
        <div><label>End Date</label><input class="w-end" placeholder="Present"></div>
      </div>
      <div><label>Bullet Points (one per line)</label><textarea class="w-bullets" placeholder="Led development of...&#10;Increased performance by..."></textarea></div>
    `;
            div.appendChild(el);
        }

        function addEdu() {
            const div = document.getElementById('eduEntries');
            const el = document.createElement('div');
            el.className = 'entry';
            el.innerHTML = `
      <button class="remove" onclick="this.parentElement.remove()">√ó</button>
      <div class="row">
        <div><label>Institution</label><input class="e-institution" placeholder="MIT"></div>
        <div><label>Degree</label><input class="e-degree" placeholder="B.S."></div>
      </div>
      <div class="row">
        <div><label>Field of Study</label><input class="e-field" placeholder="Computer Science"></div>
        <div><label>Graduation Date</label><input class="e-gradDate" placeholder="May 2020"></div>
      </div>
      <div class="row">
        <div><label>Location</label><input class="e-location" placeholder="Cambridge, MA"></div>
        <div><label>GPA</label><input class="e-gpa" placeholder="3.8"></div>
      </div>
    `;
            div.appendChild(el);
        }

        function addSkill() {
            const div = document.getElementById('skillEntries');
            const el = document.createElement('div');
            el.className = 'entry';
            el.innerHTML = `
      <button class="remove" onclick="this.parentElement.remove()">√ó</button>
      <div class="row">
        <div><label>Category</label><input class="s-category" placeholder="Programming Languages"></div>
        <div><label>Items (comma-separated)</label><input class="s-items" placeholder="JavaScript, Python, Go"></div>
      </div>
    `;
            div.appendChild(el);
        }

        function addProject() {
            const div = document.getElementById('projectEntries');
            const el = document.createElement('div');
            el.className = 'entry';
            el.innerHTML = `
      <button class="remove" onclick="this.parentElement.remove()">√ó</button>
      <div class="row">
        <div><label>Project Name</label><input class="p-name" placeholder="My Cool App"></div>
        <div><label>URL</label><input class="p-url" placeholder="https://github.com/..."></div>
      </div>
      <div class="row">
        <div><label>Keywords (comma-separated)</label><input class="p-keywords" placeholder="React, Firebase"></div>
      </div>
      <div><label>Bullet Points (one per line)</label><textarea class="p-bullets" placeholder="Built a full-stack app...&#10;Used React and Node..."></textarea></div>
    `;
            div.appendChild(el);
        }

        function addAward() {
            const div = document.getElementById('awardEntries');
            const el = document.createElement('div');
            el.className = 'entry';
            el.innerHTML = `
      <button class="remove" onclick="this.parentElement.remove()">√ó</button>
      <div class="row">
        <div><label>Title</label><input class="a-title" placeholder="Best Paper Award"></div>
        <div><label>Awarder</label><input class="a-awarder" placeholder="IEEE"></div>
        <div><label>Date</label><input class="a-date" placeholder="2023"></div>
      </div>
      <div><label>Summary</label><input class="a-summary" placeholder="Awarded for outstanding research..."></div>
    `;
            div.appendChild(el);
        }

        let customSectionCounter = 0;
        function addCustomSection() {
            const div = document.getElementById('customSectionEntries');
            const idx = customSectionCounter++;
            const el = document.createElement('div');
            el.className = 'entry';
            el.setAttribute('data-cs-idx', idx);
            el.innerHTML = `
      <button class="remove" onclick="this.parentElement.remove()">√ó</button>
      <div class="row">
        <div><label>Section Title</label><input class="cs-title" placeholder="Certifications, Volunteering, etc."></div>
      </div>
      <div class="cs-items" data-cs-idx="${idx}"></div>
      <button class="add-btn" onclick="addCustomSectionItem(${idx})">+ Add Entry to this Section</button>
    `;
            div.appendChild(el);
        }

        function addCustomSectionItem(csIdx) {
            const container = document.querySelector(`.cs-items[data-cs-idx='${csIdx}']`);
            const el = document.createElement('div');
            el.style.cssText = 'background:#fff;border:1px solid #e0e0e0;border-radius:6px;padding:10px;margin-bottom:8px;position:relative;';
            el.innerHTML = `
      <button class="remove" onclick="this.parentElement.remove()">√ó</button>
      <div class="row">
        <div><label>Title</label><input class="csi-title" placeholder="AWS Solutions Architect"></div>
        <div><label>Subtitle</label><input class="csi-subtitle" placeholder="Amazon Web Services"></div>
      </div>
      <div class="row">
        <div><label>Date</label><input class="csi-date" placeholder="2023"></div>
        <div><label>Location</label><input class="csi-location" placeholder="Online"></div>
        <div><label>Link</label><input class="csi-link" placeholder="https://..."></div>
      </div>
      <div><label>Bullet Points (one per line)</label><textarea class="csi-bullets" placeholder="Completed certification..."></textarea></div>
    `;
            container.appendChild(el);
        }

        /* ‚îÄ‚îÄ Build the data object ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

        function buildData() {
            const data = {};
            const v = (id) => document.getElementById(id)?.value?.trim() || '';

            // Basics
            const basics = {};
            if (v('name')) basics.name = v('name');
            if (v('email')) basics.email = v('email');
            if (v('phone')) basics.phone = v('phone');
            if (v('address')) basics.address = v('address');
            if (v('linkedin')) basics.linkedin = v('linkedin');
            if (v('github')) basics.github = v('github');
            if (Object.keys(basics).length) data.basics = basics;

            // Work
            const workEls = document.querySelectorAll('#workEntries .entry');
            if (workEls.length) {
                data.work = [...workEls].map(el => ({
                    company: el.querySelector('.w-company').value.trim(),
                    position: el.querySelector('.w-position').value.trim(),
                    location: el.querySelector('.w-location').value.trim(),
                    startDate: el.querySelector('.w-start').value.trim(),
                    endDate: el.querySelector('.w-end').value.trim(),
                    bullets: el.querySelector('.w-bullets').value.split('\n').filter(l => l.trim()),
                }));
            }

            // Education
            const eduEls = document.querySelectorAll('#eduEntries .entry');
            if (eduEls.length) {
                data.education = [...eduEls].map(el => ({
                    institution: el.querySelector('.e-institution').value.trim(),
                    degree: el.querySelector('.e-degree').value.trim(),
                    field: el.querySelector('.e-field').value.trim(),
                    graduationDate: el.querySelector('.e-gradDate').value.trim(),
                    location: el.querySelector('.e-location').value.trim(),
                    gpa: el.querySelector('.e-gpa').value.trim() || undefined,
                }));
            }

            // Skills
            const skillEls = document.querySelectorAll('#skillEntries .entry');
            if (skillEls.length) {
                data.skills = [...skillEls].map(el => ({
                    category: el.querySelector('.s-category').value.trim(),
                    items: el.querySelector('.s-items').value.split(',').map(s => s.trim()).filter(Boolean),
                }));
            }

            // Projects
            const projEls = document.querySelectorAll('#projectEntries .entry');
            if (projEls.length) {
                data.projects = [...projEls].map(el => ({
                    name: el.querySelector('.p-name').value.trim(),
                    url: el.querySelector('.p-url').value.trim() || undefined,
                    keywords: el.querySelector('.p-keywords').value.split(',').map(s => s.trim()).filter(Boolean),
                    bullets: el.querySelector('.p-bullets').value.split('\n').filter(l => l.trim()),
                }));
            }

            // Awards
            const awardEls = document.querySelectorAll('#awardEntries .entry');
            if (awardEls.length) {
                data.awards = [...awardEls].map(el => ({
                    title: el.querySelector('.a-title').value.trim(),
                    awarder: el.querySelector('.a-awarder').value.trim(),
                    date: el.querySelector('.a-date').value.trim(),
                    summary: el.querySelector('.a-summary').value.trim() || undefined,
                }));
            }

            // Custom Sections
            const csEls = document.querySelectorAll('#customSectionEntries > .entry');
            if (csEls.length) {
                data.customSections = [...csEls].map(csEl => {
                    const csIdx = csEl.getAttribute('data-cs-idx');
                    const itemEls = csEl.querySelectorAll(`.cs-items[data-cs-idx='${csIdx}'] > div`);
                    return {
                        id: 'custom-' + csIdx,
                        title: csEl.querySelector('.cs-title').value.trim() || 'Custom Section',
                        type: 'bullets',
                        items: [...itemEls].map(it => ({
                            title: it.querySelector('.csi-title').value.trim(),
                            subtitle: it.querySelector('.csi-subtitle').value.trim(),
                            date: it.querySelector('.csi-date').value.trim(),
                            location: it.querySelector('.csi-location').value.trim(),
                            link: it.querySelector('.csi-link').value.trim(),
                            bullets: it.querySelector('.csi-bullets').value.split('\n').filter(l => l.trim()),
                        })),
                    };
                });
            }

            // Job ‚Üí auto cover letter
            if (v('jobTitle') && v('jobCompany')) {
                data.job = {
                    title: v('jobTitle'),
                    company: v('jobCompany'),
                    companyAddress: v('jobAddress') || undefined,
                    description: v('jobDesc') || undefined,
                    skills: v('jobSkills') ? v('jobSkills').split(',').map(s => s.trim()).filter(Boolean) : undefined,
                };
            }

            // Template
            const tmpl = v('fmtTemplate');
            if (tmpl) data.selectedTemplate = Number(tmpl);

            // Formatting ‚Äî collect ALL fields
            const formatting = {};
            const fmtFields = [
                ['fmtFontFamily', 'fontFamily'],
                ['fmtBaseFontSize', 'baseFontSize'],
                ['fmtNameSize', 'nameSize'],
                ['fmtSectionTitleSize', 'sectionTitleSize'],
                ['fmtSectionHeaderStyle', 'sectionHeaderStyle'],
                ['fmtHeaderAlignment', 'headerAlignment'],
                ['fmtSocialIconStyle', 'socialIconStyle'],
                ['fmtFontWeightName', 'fontWeightName'],
                ['fmtFontWeightSectionTitle', 'fontWeightSectionTitle'],
                ['fmtFontWeightBody', 'fontWeightBody'],
                ['fmtLineSpacing', 'lineSpacing'],
                ['fmtSectionSpacing', 'sectionSpacing'],
                ['fmtParagraphSpacing', 'paragraphSpacing'],
                ['fmtEntrySpacing', 'entrySpacing'],
                ['fmtBulletSpacing', 'bulletSpacing'],
                ['fmtBulletGap', 'bulletGap'],
                ['fmtPageMargins', 'pageMargins'],
                ['fmtMarginTop', 'marginTop'],
                ['fmtMarginBottom', 'marginBottom'],
                ['fmtMarginLeft', 'marginLeft'],
                ['fmtMarginRight', 'marginRight'],
                ['fmtColorTheme', 'colorTheme'],
                ['fmtCustomColor', 'customColor'],
                ['fmtBulletStyle', 'bulletStyle'],
                ['fmtBulletIndent', 'bulletIndent'],
                ['fmtSectionDividers', 'sectionDividers'],
                ['fmtHeaderLineStyle', 'headerLineStyle'],
                ['fmtSeparator', 'separator'],
                ['fmtPageFormat', 'pageFormat'],
            ];
            for (const [elId, key] of fmtFields) {
                const val = v(elId);
                if (val) formatting[key] = val;
            }
            // Boolean fields
            const sectionTitleBoldEl = document.getElementById('fmtSectionTitleBold');
            const sectionTitleUnderlineEl = document.getElementById('fmtSectionTitleUnderline');
            const showIconsEl = document.getElementById('fmtShowIcons');
            if (sectionTitleBoldEl.checked) formatting.sectionTitleBold = true;
            if (sectionTitleUnderlineEl.checked) formatting.sectionTitleUnderline = true;
            if (showIconsEl.checked) formatting.showIcons = true;

            if (Object.keys(formatting).length) data.formatting = formatting;

            return data;
        }

        const PREFILL_KEY = 'resume_builder_prefill';

        /* ‚îÄ‚îÄ Actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

        function openResumeBuilder() {
            const data = buildData();
            localStorage.setItem(PREFILL_KEY, JSON.stringify(data));
            window.open(window.location.origin + '/', '_blank');
        }

        /* ‚îÄ‚îÄ JSON Save / Load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

        function buildAndShowJson() {
            const data = buildData();
            document.getElementById('jsonEditor').value = JSON.stringify(data, null, 2);
            showStatus('JSON built from form fields ‚úì', 'success');
        }

        function copyJson() {
            const ta = document.getElementById('jsonEditor');
            if (!ta.value.trim()) { showStatus('Nothing to copy ‚Äî build or paste JSON first', 'error'); return; }
            navigator.clipboard.writeText(ta.value).then(() => showStatus('Copied to clipboard ‚úì', 'success'));
        }

        function saveJsonToFile() {
            const ta = document.getElementById('jsonEditor');
            if (!ta.value.trim()) { buildAndShowJson(); }
            const blob = new Blob([ta.value], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'resume-prefill.json';
            a.click();
            URL.revokeObjectURL(url);
            showStatus('Saved to resume-prefill.json ‚úì', 'success');
        }

        function loadJsonFromFile() {
            document.getElementById('jsonFileInput').click();
        }

        function handleFileLoad(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const json = JSON.parse(e.target.result);
                    document.getElementById('jsonEditor').value = JSON.stringify(json, null, 2);
                    showStatus(`Loaded ${file.name} ‚úì`, 'success');
                } catch (err) {
                    showStatus('Invalid JSON file: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // reset so same file can be re-loaded
        }

        function loadJsonIntoBuilder() {
            const ta = document.getElementById('jsonEditor');
            if (!ta.value.trim()) { showStatus('No JSON to load ‚Äî paste or build JSON first', 'error'); return; }
            try {
                const data = JSON.parse(ta.value);
                localStorage.setItem(PREFILL_KEY, JSON.stringify(data));
                window.open(window.location.origin + '/', '_blank');
                showStatus('Loaded into Resume Builder ‚úì', 'success');
            } catch (err) {
                showStatus('Invalid JSON: ' + err.message, 'error');
            }
        }

        function showStatus(msg, type) {
            const el = document.getElementById('jsonStatus');
            el.textContent = msg;
            el.className = 'status ' + type;
            setTimeout(() => { el.className = 'status'; }, 4000);
        }

        /* ‚îÄ‚îÄ Fill Sample Data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

        function fillSampleData() {
            document.getElementById('name').value = 'Sarah Mitchell';
            document.getElementById('email').value = 'sarah.mitchell@email.com';
            document.getElementById('phone').value = '(555) 123-4567';
            document.getElementById('address').value = 'San Francisco, CA';
            document.getElementById('linkedin').value = 'https://linkedin.com/in/sarahmitchell';
            document.getElementById('github').value = 'https://github.com/sarahmitchell';

            // Clear existing
            document.getElementById('workEntries').innerHTML = '';
            document.getElementById('eduEntries').innerHTML = '';
            document.getElementById('skillEntries').innerHTML = '';
            document.getElementById('projectEntries').innerHTML = '';
            document.getElementById('awardEntries').innerHTML = '';
            document.getElementById('customSectionEntries').innerHTML = '';

            // Work
            addWork();
            const w1 = document.querySelector('#workEntries .entry:last-child');
            w1.querySelector('.w-company').value = 'TechVision Inc.';
            w1.querySelector('.w-position').value = 'Senior Software Engineer';
            w1.querySelector('.w-location').value = 'San Francisco, CA';
            w1.querySelector('.w-start').value = 'Mar 2021';
            w1.querySelector('.w-end').value = 'Present';
            w1.querySelector('.w-bullets').value = 'Led frontend architecture migration to React + TypeScript\nReduced page load time by 40% through code splitting and lazy loading\nMentored a team of 4 junior developers';

            addWork();
            const w2 = document.querySelector('#workEntries .entry:last-child');
            w2.querySelector('.w-company').value = 'DataFlow Solutions';
            w2.querySelector('.w-position').value = 'Software Engineer';
            w2.querySelector('.w-location').value = 'Remote';
            w2.querySelector('.w-start').value = 'Jun 2019';
            w2.querySelector('.w-end').value = 'Feb 2021';
            w2.querySelector('.w-bullets').value = 'Built RESTful APIs serving 10M+ requests/day\nImplemented CI/CD pipelines reducing deployment time by 60%';

            // Education
            addEdu();
            const e1 = document.querySelector('#eduEntries .entry:last-child');
            e1.querySelector('.e-institution').value = 'University of California, Berkeley';
            e1.querySelector('.e-degree').value = 'B.S.';
            e1.querySelector('.e-field').value = 'Computer Science';
            e1.querySelector('.e-gradDate').value = 'May 2019';
            e1.querySelector('.e-location').value = 'Berkeley, CA';
            e1.querySelector('.e-gpa').value = '3.8';

            // Skills
            addSkill();
            const s1 = document.querySelector('#skillEntries .entry:last-child');
            s1.querySelector('.s-category').value = 'Languages';
            s1.querySelector('.s-items').value = 'JavaScript, TypeScript, Python, Go';

            addSkill();
            const s2 = document.querySelector('#skillEntries .entry:last-child');
            s2.querySelector('.s-category').value = 'Frameworks';
            s2.querySelector('.s-items').value = 'React, Next.js, Node.js, Express, Django';

            addSkill();
            const s3 = document.querySelector('#skillEntries .entry:last-child');
            s3.querySelector('.s-category').value = 'Tools';
            s3.querySelector('.s-items').value = 'Git, Docker, AWS, PostgreSQL, Redis';

            // Projects
            addProject();
            const p1 = document.querySelector('#projectEntries .entry:last-child');
            p1.querySelector('.p-name').value = 'Open Source Dashboard';
            p1.querySelector('.p-url').value = 'https://github.com/sarahmitchell/dashboard';
            p1.querySelector('.p-keywords').value = 'React, D3.js, TypeScript';
            p1.querySelector('.p-bullets').value = 'Built an analytics dashboard used by 2K+ developers\nImplemented real-time data visualization with D3.js';

            // Job
            document.getElementById('jobTitle').value = 'Senior Software Engineer';
            document.getElementById('jobCompany').value = 'TechVision Inc.';
            document.getElementById('jobAddress').value = '456 Innovation Dr, San Francisco, CA 94102';
            document.getElementById('jobSkills').value = 'JavaScript, TypeScript, React, Node.js, AWS';
            document.getElementById('jobDesc').value = 'We are looking for an experienced Senior Software Engineer to lead our frontend platform team.';

            // Awards
            addAward();
            const a1 = document.querySelector('#awardEntries .entry:last-child');
            a1.querySelector('.a-title').value = 'Best Paper Award';
            a1.querySelector('.a-awarder').value = 'IEEE Conference';
            a1.querySelector('.a-date').value = '2023';
            a1.querySelector('.a-summary').value = 'Awarded for research on frontend performance optimization';

            // Custom Section ‚Äî Certifications
            addCustomSection();
            const cs1 = document.querySelector('#customSectionEntries > .entry:last-child');
            cs1.querySelector('.cs-title').value = 'Certifications';
            const csIdx = cs1.getAttribute('data-cs-idx');

            addCustomSectionItem(Number(csIdx));
            const csi1 = cs1.querySelector('.cs-items > div:last-child');
            csi1.querySelector('.csi-title').value = 'AWS Solutions Architect';
            csi1.querySelector('.csi-subtitle').value = 'Amazon Web Services';
            csi1.querySelector('.csi-date').value = '2022';
            csi1.querySelector('.csi-location').value = 'Online';
            csi1.querySelector('.csi-bullets').value = 'Designed scalable cloud architectures\nManaged multi-region deployments';

            addCustomSectionItem(Number(csIdx));
            const csi2 = cs1.querySelector('.cs-items > div:last-child');
            csi2.querySelector('.csi-title').value = 'Google Cloud Professional';
            csi2.querySelector('.csi-subtitle').value = 'Google';
            csi2.querySelector('.csi-date').value = '2021';

            // Template & Formatting
            document.getElementById('fmtTemplate').value = '1';
            document.getElementById('fmtFontFamily').value = 'calibri';
            document.getElementById('fmtBaseFontSize').value = '11pt';
            document.getElementById('fmtNameSize').value = 'large';
            document.getElementById('fmtSectionTitleSize').value = 'normal';
            document.getElementById('fmtSectionHeaderStyle').value = 'uppercase';
            document.getElementById('fmtSectionTitleBold').checked = true;
            document.getElementById('fmtSectionTitleUnderline').checked = false;
            document.getElementById('fmtShowIcons').checked = true;
            document.getElementById('fmtHeaderAlignment').value = 'center';
            document.getElementById('fmtColorTheme').value = 'navy';
            document.getElementById('fmtBulletStyle').value = 'bullet';
            document.getElementById('fmtSectionDividers').value = 'line';
            document.getElementById('fmtLineSpacing').value = '1.15';
            document.getElementById('fmtSectionSpacing').value = 'normal';
            document.getElementById('fmtPageFormat').value = 'Letter';
            document.getElementById('fmtSeparator').value = '|';
        }
    </script>
</body>

</html>